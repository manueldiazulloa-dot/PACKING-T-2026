<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PACKING T - SISTEMA 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #ffffff; --border: #334155; --primary: #2563eb; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 15px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        /* Estilo de Botones Colapsables (como ayer) */
        .collapsible { background: var(--card); color: var(--text); cursor: pointer; padding: 15px; width: 100%; border: 1px solid var(--border); text-align: left; outline: none; font-size: 16px; font-weight: bold; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; transition: 0.3s; }
        .collapsible:hover { background: #2d3748; }
        .active { border-color: var(--primary); background: #1a202c; }

        .content { padding: 0 18px; display: none; overflow: hidden; background-color: var(--card); border-radius: 0 0 8px 8px; margin-bottom: 10px; border: 1px solid var(--border); border-top: none; }
        
        /* Grid de inputs compacto */
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; padding: 15px 0; }
        input { background: #0f172a; color: white; border: 1px solid var(--primary); padding: 8px; border-radius: 5px; font-size: 14px; }
        label { font-size: 12px; color: #94a3b8; text-transform: uppercase; }

        .btn-action { width: 100%; padding: 10px; margin: 10px 0; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .bg-green { background: #10b981; }
        .bg-red { background: #ef4444; }

        /* Tabla Estilo Ayer */
        .table-card { background: var(--card); border-radius: 8px; border: 1px solid var(--border); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #1e40af; color: white; padding: 10px; font-size: 13px; text-transform: uppercase; }
        td { padding: 10px; border-bottom: 1px solid var(--border); text-align: center; font-weight: bold; }
        
        .alerta-row { color: #f87171; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.6; } }
        .oculto { display: none !important; }
    </style>
</head>
<body>

    <div class="header">
        <strong>PACKING T - SISTEMA 2026</strong>
        <div style="display:flex; gap:10px;">
            <button class="btn-action" style="background:#6366f1; padding:5px 15px;" onclick="exportPDF()">PDF</button>
            <button class="btn-action" style="background:#22c55e; padding:5px 15px;" onclick="exportExcel()">EXCEL</button>
        </div>
    </div>

    <button class="collapsible">游댌 AUDITOR칈A DE GU칈AS</button>
    <div class="content">
        <div class="grid-inputs">
            <div style="grid-column: span 2;">
                <select id="selGuia" style="width:100%; padding:10px; background:#0f172a; color:white; border:1px solid var(--primary); border-radius:5px;">
                    <option value="">-- SELECCIONE GU칈A --</option>
                </select>
            </div>
            <button class="btn-action bg-green" style="margin:10px 0;" onclick="alert('Buscando...')">VER DETALLE</button>
        </div>
    </div>

    <button class="collapsible">游닌 / 游닋 REGISTRAR MOVIMIENTO</button>
    <div class="content">
        <div class="grid-inputs">
            <div><label>C칩digo</label><input type="text" id="c_cod" oninput="validar()" placeholder="Ej: AGR 1"></div>
            <div id="f_nom"><label>Nombre</label><input type="text" id="c_nom"></div>
            <div id="f_min"><label>M칤nimo</label><input type="number" id="c_min" value="10"></div>
            <div><label>N춿 Gu칤a</label><input type="text" id="c_guia"></div>
            <div><label>Patente</label><input type="text" id="c_patente"></div>
            <div><label>Chofer</label><input type="text" id="c_chofer"></div>
            <div><label id="lblProc">Procedencia</label><input type="text" id="c_proc"></div>
            <div><label>Cantidad</label><input type="number" id="c_cant" style="border-width:2px;"></div>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn-action bg-green" onclick="operar('ENTRADA')">REGISTRAR ENTRADA</button>
            <button class="btn-action bg-red" onclick="operar('SALIDA')">REGISTRAR SALIDA</button>
        </div>
    </div>

    <div class="table-card">
        <div style="padding:10px; background:#1e293b; border-bottom:1px solid var(--border);">游늶 EXISTENCIA DE BODEGA</div>
        <table>
            <thead>
                <tr>
                    <th>MATERIAL</th>
                    <th>ENTRADAS</th>
                    <th>SALIDAS</th>
                    <th>M칈NIMO</th>
                    <th>REAL</th>
                </tr>
            </thead>
            <tbody id="listaBody"></tbody>
        </table>
    </div>

    <div style="height: 200px; margin-top:15px;">
        <canvas id="chartStock"></canvas>
    </div>

<script>
    let db = JSON.parse(localStorage.getItem('pack_v5_2026')) || [];
    let chart;

    // L칩gica de Acorde칩n
    document.querySelectorAll(".collapsible").forEach(btn => {
        btn.addEventListener("click", function() {
            this.classList.toggle("active");
            let content = this.nextElementSibling;
            content.style.display = content.style.display === "block" ? "none" : "block";
        });
    });

    function validar() {
        const cod = document.getElementById('c_cod').value.trim();
        const existe = db.find(i => i.codigo === cod);
        document.getElementById('f_nom').classList.toggle('oculto', !!existe);
        document.getElementById('f_min').classList.toggle('oculto', !!existe);
        document.getElementById('lblProc').innerText = existe ? "DESTINO" : "PROCEDENCIA";
    }

    function operar(tipo) {
        const cod = document.getElementById('c_cod').value.trim();
        const q = parseInt(document.getElementById('c_cant').value) || 0;
        if(!cod || q <= 0) return alert("Complete datos");

        let idx = db.findIndex(i => i.codigo === cod);
        if(idx !== -1) {
            if(tipo === 'SALIDA' && db[idx].real < q) return alert("Stock insuficiente");
            db[idx].entradas += (tipo === 'ENTRADA' ? q : 0);
            db[idx].salidas += (tipo === 'SALIDA' ? q : 0);
            db[idx].real += (tipo === 'ENTRADA' ? q : -q);
        } else {
            const nom = document.getElementById('c_nom').value;
            const min = parseInt(document.getElementById('c_min').value) || 0;
            db.push({codigo:cod, nombre:nom, entradas:q, salidas:0, real:q, minimo:min});
        }
        localStorage.setItem('pack_v5_2026', JSON.stringify(db));
        location.reload();
    }

    function render() {
        const b = document.getElementById('listaBody');
        b.innerHTML = "";
        db.forEach(i => {
            const bajo = i.real <= i.minimo;
            b.innerHTML += `<tr class="${bajo ? 'alerta-row' : ''}">
                <td>${i.codigo} - ${i.nombre}</td>
                <td>${i.entradas}</td><td>${i.salidas}</td><td>${i.minimo}</td>
                <td>${i.real} ${bajo ? '丘멆잺' : ''}</td>
            </tr>`;
        });
        initChart();
    }

    function initChart() {
        const ctx = document.getElementById('chartStock').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: db.map(i => i.codigo),
                datasets: [{ label: 'Stock', data: db.map(i => i.real), backgroundColor: '#2563eb' }]
            },
            options: { maintainAspectRatio: false }
        });
    }

    function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("EXISTENCIAS PACKING T", 14, 15);
        doc.autoTable({ head: [['Material', 'Stock']], body: db.map(i => [i.codigo, i.real]) });
        doc.save("Inventario.pdf");
    }

    function exportExcel() {
        const ws = XLSX.utils.json_to_sheet(db);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Stock");
        XLSX.writeFile(wb, "Reporte.xlsx");
    }

    render();
</script>
</body>
</html>
