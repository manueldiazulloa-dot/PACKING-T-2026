<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INV-PRO v1.1 - PACKING T</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --bg-dark: #0b1120;
            --sidebar-bg: #0f172a;
            --card-bg: #1e293b;
            --primary-blue: #2563eb;
            --success-green: #10b981;
            --warning-orange: #f97316;
            --danger-red: #ef4444;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            display: flex;
            height: 100vh;
        }

        /* BARRA LATERAL */
        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid #334155;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .logo {
            font-size: 22px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 40px;
        }

        .logo span { color: var(--primary-blue); font-size: 14px; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--text-muted);
            text-decoration: none;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .nav-item:hover, .nav-item.active {
            background-color: var(--primary-blue);
            color: white;
        }

        /* CONTENIDO PRINCIPAL */
        .main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .page { display: none; }
        .page.active { display: block; }

        /* TARJETAS DASHBOARD */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-val { font-size: 28px; font-weight: bold; display: block; }
        .stat-label { color: var(--text-muted); font-size: 12px; text-transform: uppercase; }

        /* FORMULARIOS */
        .form-container {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .full-width { grid-column: span 2; }

        .input-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; }
        label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; font-weight: 600; }
        
        input, select {
            background: #0f172a;
            border: 1px solid #334155;
            padding: 12px;
            border-radius: 8px;
            color: white;
            outline: none;
        }

        input:focus { border-color: var(--primary-blue); }

        .btn-submit {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* TABLAS */
        .table-container {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            margin-top: 20px;
        }

        table { width: 100%; border-collapse: collapse; }
        th { background: #1e293b; padding: 15px; text-align: left; color: var(--text-muted); font-size: 12px; }
        td { padding: 15px; border-bottom: 1px solid #334155; }

        .status-pill { padding: 4px 10px; border-radius: 5px; font-size: 11px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo">游닍 INV-PRO <span>v1.1</span></div>
        <div class="nav-item active" onclick="showPage('dashboard', this)">游늵 Dashboard</div>
        <div class="nav-item" onclick="showPage('existencias', this)">游닍 Existencias</div>
        <div class="nav-item" onclick="showPage('entradas', this)">拘勇 Entradas</div>
        <div class="nav-item" onclick="showPage('salidas', this)">拘勇 Salidas</div>
        <div class="nav-item" onclick="showPage('reportes', this)">游늵 Reportes</div>
    </div>

    <div class="main">
        
        <div id="page-dashboard" class="page active">
            <div class="stats-grid">
                <div class="stat-card"><div><span class="stat-label">Stock Total</span><span class="stat-val" id="dash-total">0</span></div></div>
                <div class="stat-card"><div><span class="stat-label">Alertas</span><span class="stat-val" style="color:var(--danger-red)" id="dash-alert">0</span></div></div>
                <div class="stat-card"><div><span class="stat-label">Entradas</span><span class="stat-val" style="color:var(--success-green)" id="dash-in">0</span></div></div>
                <div class="stat-card"><div><span class="stat-label">Salidas</span><span class="stat-val" style="color:var(--warning-orange)" id="dash-out">0</span></div></div>
            </div>
            <div class="form-container">
                <h3>An치lisis de Movimientos</h3>
                <canvas id="chartMovimientos" height="100"></canvas>
            </div>
        </div>

        <div id="page-existencias" class="page">
            <div class="form-container">
                <h2>Nuevo Producto</h2>
                <div class="form-grid">
                    <div class="input-group full-width"><label>C칩digo</label><input type="text" id="ex-cod" placeholder="SKU-001"></div>
                    <div class="input-group full-width"><label>Material</label><input type="text" id="ex-nom" placeholder="Descripci칩n del material..."></div>
                    <div class="input-group"><label>Stock Inicial</label><input type="number" id="ex-ini"></div>
                    <div class="input-group"><label>Stock M칤nimo</label><input type="number" id="ex-min"></div>
                </div>
                <button class="btn-submit" style="background: var(--primary-blue)" onclick="crearProducto()">Guardar Registro</button>
            </div>
            <div class="table-container">
                <table>
                    <thead><tr><th>C칍DIGO</th><th>MATERIAL</th><th>STOCK REAL</th><th>STOCK M칈NIMO</th><th>ESTADO</th></tr></thead>
                    <tbody id="listaExistencias"></tbody>
                </table>
            </div>
        </div>

        <div id="page-entradas" class="page">
            <div class="form-container">
                <h2 style="color: var(--success-green)">拘勇 Registrar Entrada</h2>
                <div class="form-grid">
                    <div class="input-group full-width"><label>Producto</label><select id="in-sel"></select></div>
                    <div class="input-group"><label>Fecha</label><input type="date" id="in-fecha"></div>
                    <div class="input-group"><label>N춿 Gu칤a</label><input type="text" id="in-guia"></div>
                    <div class="input-group full-width"><label>Cantidad</label><input type="number" id="in-cant"></div>
                    <div class="input-group full-width"><label>Chofer</label><input type="text" id="in-chofer"></div>
                    <div class="input-group"><label>Patente</label><input type="text" id="in-patente"></div>
                    <div class="input-group"><label>Procedencia</label><input type="text" id="in-proc"></div>
                </div>
                <button class="btn-submit" style="background: var(--success-green)" onclick="registrarMovimiento('IN')">Guardar Registro</button>
            </div>
        </div>

        <div id="page-salidas" class="page">
            <div class="form-container">
                <h2 style="color: var(--warning-orange)">拘勇 Registrar Salida</h2>
                <div class="form-grid">
                    <div class="input-group full-width"><label>Producto</label><select id="out-sel"></select></div>
                    <div class="input-group"><label>Fecha</label><input type="date" id="out-fecha"></div>
                    <div class="input-group"><label>N춿 Gu칤a</label><input type="text" id="out-guia"></div>
                    <div class="input-group full-width"><label>Cantidad</label><input type="number" id="out-cant"></div>
                    <div class="input-group full-width"><label>Chofer</label><input type="text" id="out-chofer"></div>
                    <div class="input-group"><label>Patente</label><input type="text" id="out-patente"></div>
                    <div class="input-group"><label>Destino</label><input type="text" id="out-dest"></div>
                </div>
                <button class="btn-submit" style="background: var(--warning-orange)" onclick="registrarMovimiento('OUT')">Guardar Registro</button>
            </div>
        </div>

        <div id="page-reportes" class="page">
            <div class="stats-grid">
                <div class="stat-card" onclick="exportPDF('GUIAS')" style="cursor:pointer"><div><span class="stat-label">Reporte</span><span class="stat-val">Gu칤as PDF</span></div></div>
                <div class="stat-card" onclick="exportPDF('STOCK')" style="cursor:pointer"><div><span class="stat-label">Existencias</span><span class="stat-val">Stock PDF</span></div></div>
                <div class="stat-card" onclick="exportExcel()" style="cursor:pointer"><div><span class="stat-label">Exportaci칩n</span><span class="stat-val">Descargar Excel</span></div></div>
            </div>
        </div>

    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('INV_PRO_V1')) || { productos: [], movimientos: [] };

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-'+id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            if(id === 'dashboard') updateDash();
            if(id === 'existencias' || id === 'entradas' || id === 'salidas') updateSelectors();
        }

        function crearProducto() {
            const cod = document.getElementById('ex-cod').value;
            const nom = document.getElementById('ex-nom').value;
            const ini = parseInt(document.getElementById('ex-ini').value) || 0;
            const min = parseInt(document.getElementById('ex-min').value) || 0;

            if(!cod || !nom) return alert("Complete los campos");

            db.productos.push({ cod, nom, stock: ini, min });
            save();
            renderExistencias();
        }

        function registrarMovimiento(tipo) {
            const prefix = tipo === 'IN' ? 'in' : 'out';
            const cod = document.getElementById(prefix+'-sel').value;
            const cant = parseInt(document.getElementById(prefix+'-cant').value);
            
            let p = db.productos.find(i => i.cod === cod);
            if(tipo === 'OUT' && p.stock < cant) return alert("Stock insuficiente");

            p.stock += (tipo === 'IN' ? cant : -cant);
            db.movimientos.push({
                tipo, cod, cant, 
                guia: document.getElementById(prefix+'-guia').value,
                fecha: document.getElementById(prefix+'-fecha').value
            });
            save();
            alert("Registro Guardado");
        }

        function renderExistencias() {
            const tbody = document.getElementById('listaExistencias');
            tbody.innerHTML = db.productos.map(p => {
                const isLow = p.stock <= p.min;
                return `<tr>
                    <td>${p.cod}</td><td>${p.nom}</td>
                    <td style="color:${isLow ? 'red':'white'}">${p.stock}</td>
                    <td>${p.min}</td>
                    <td><span class="status-pill" style="background:${isLow ? '#450a0a':'#064e3b'}">${isLow ? 'ALERTA':'칍PTIMO'}</span></td>
                </tr>`;
            }).join('');
        }

        function updateSelectors() {
            const options = db.productos.map(p => `<option value="${p.cod}">${p.nom}</option>`).join('');
            document.getElementById('in-sel').innerHTML = options;
            document.getElementById('out-sel').innerHTML = options;
            renderExistencias();
        }

        function updateDash() {
            document.getElementById('dash-total').innerText = db.productos.reduce((a,b)=> a + b.stock, 0);
            document.getElementById('dash-alert').innerText = db.productos.filter(p => p.stock <= p.min).length;
            document.getElementById('dash-in').innerText = db.movimientos.filter(m => m.tipo === 'IN').length;
            document.getElementById('dash-out').innerText = db.movimientos.filter(m => m.tipo === 'OUT').length;
        }

        function save() { localStorage.setItem('INV_PRO_V1', JSON.stringify(db)); }
        
        // Carga inicial
        document.getElementById('in-fecha').valueAsDate = new Date();
        document.getElementById('out-fecha').valueAsDate = new Date();
        updateDash();
    </script>
</body>
</html>
